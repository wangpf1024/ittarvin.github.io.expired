---
layout: post
subtitle: 《操作系统》6小节： 进程组织，进程控制
tags: [操作系统]
comments: false
cover-img: /assets/img/IMG_1753.JPG
thumbnail-img: /assets/img/操作系统概论.jpeg
share-img: /assets/img/IMG_1482.JPG
---
进程控制块的状态字段描述了进程当前所处的状态。它由一组标志组成，其中每个标志描述了一种可能的进程状态。

# 操作系统

### 进程的3种基本状态

1. 就绪态
就绪态就是进程一旦获得CPU就可以投入运行的状态。
2. 执行态
执行态就是进程获得CPU正在运行的状态。
3. 阻塞态
阻塞态就是进程由于等待资源或某个事件而发生的暂停执行的状态。

三者的转换

![操作系统-进程状态.png](/assets/img/操作系统-进程状态.png){: .mx-auto.d-block :}

新创建的进程的状态一般被设置为就绪态，当操作系统为就绪态的进程分配CPU是，
进程开始在CPU上运行，进程的状态就由就绪态变为执行态。
执行态的进程可能变成就绪态，也可能变成阻塞态。
当进程在CPU上运行时间片递减为0时，系统就把CPU分陪给其它就绪态进程，并把当前执行进的状态变为就绪态。
如果执行态中的进程因申请某种资源或等待某事件的方式而不宜占用CPU，系统会把进程的状态改变为阻塞态，并暂停该进程的执行，将CPU分配给其它就绪态进程。
阻塞态进程在等待的事件发生或申请到说需要资源后，系统将其状态变更为就绪态。

### 进程的组织
在操作系统中任意时刻都可能存在多个进程，每个进程对应一个[进程控制块(PCB)](/2022-07-05-Operating-System-进程概念)，操作系统组织和管理进程是通过管理和组织进程控制块来实现。主要目的就是使操作系统的程序在需要时能有有效的方式检索的系统中的每一个进程。实际对进程的的组织时通过定义数据结构来实现的。

1. 链接方式
把系统中具有相同状态的进程的进程的控制块用其中的链接字链接成一个队列。

![操作系统-进程组织-链接.png](/assets/img/操作系统-进程组织-链接.png){: .mx-auto.d-block :}
2. 索引方式
系统根据所有进程的状态，建立几张索引表，索引表的每一个表项指向一个PCB的物理块。

![操作系统-进程组织-索引表.png](/assets/img/操作系统-进程组织-索引表.png){: .mx-auto.d-block :}
3. 进程队列
把进程控制块用对了组织起来， 形成进程队列。把具有相同状态的进程放入同一个队列中，就有不同状态的进程形成了不同的进程队列。（就绪队列，阻塞队列）。

![操作系统-进程组织-队列.png](/assets/img/操作系统-进程组织-队列.png){: .mx-auto.d-block :}

##  进程控制

### 进程的创建
创建新的进程包括为进程分配必要的资源，建立操作系统用于管理进程的数据结构如进程控制块等。通常在下列情况下需要创建新进程：

1. 用户登陆。
   在交互式的系统中，当一个新用户登陆系统时候会创建进程。

2. 作业调度。
   当把位于外存存储器中的作用调如内存准备运行的时候，操作系统为作用运行创建进程。

3. 提供服务。
   操作系统可以创建一个进程，代表用户程序执行某种功能，使用户无需等待。

4. 应用请求。
   当用户发出执行某个程序的命令，或用户程序在执行中基于并行的要求在程序中显示调用进程创建系统调用时，都会引起进程的创建。

当新的进程创建时候，有两种执行可能。
1. 父进程与子进程并发执行。
2. 父进程等待，直到某个或全部子进程执行完毕。

新进程的地址空间也有两种可能。
1. 子进程共享父进程的地址空间。
2. 子进程拥有独立的地址空间。

创建进程的一般步骤如下：
1. 申请空白的PCB。
2. 为新进程分配资源。
3. 初始化PCB。
4. 将新进程插入就绪队列。

![操作系统-进程控制-创建.png](/assets/img/操作系统-进程控制-创建.png)


### 进程的阻塞
操作系统在下列情况下可能进程阻塞操作。
1. 请求服务。
   例如打印服务，进程在提出打印服务请求后，系统创建打印服务的进程为该进程服务，而提出打印请求的服务进程可能被阻塞起来，等待打印完成。

3. 启动某种操作。
   例如进程发出启动I/O或启动打印机后，等待启动完成时处于阻塞状态。

4. 新数据尚未到达。
   对于一个计算进程，如果输入的数据还没有到达，计算进程需要阻塞起来等待。

5. 无新工作可做。
   发出消息之后等待时。

完成进程阻塞的简化过程如下：
1. 将进程的状态改为阻塞态。
2. 将进程插入相应的阻塞队列中。
3. 转进程调度程序，从就绪队列中选择进程为其分配CPU。    

![操作系统-进程控制-阻塞.png](/assets/img/操作系统-进程控制-阻塞.png)

### 进程的唤醒
进程的唤醒过程如下：
1. 将进程从阻塞队列中移除，
2. 将进程状态由阻塞态改为就绪态。
3. 将进程插入就绪队列。

![操作系统-进程控制-唤醒.png](/assets/img/操作系统-进程控制-唤醒.png)


### 进程的终止
进程的终止也称为进程撤销，下列情况下，进程会被终止。
1. 当进程正常执行完毕，调用终止进程的系统调用，请求操作系统删除该进程。
2. 一个进程调用适当的系统调用，终止另一个进程。

父进程终止其子进程的原因有可能有以下几个：
1. 子进程适用了超过它所分配到的一些资源。
2. 分配给子进程的任务已不再需要。
3. 父进程退出，如果父进程终止，那么操作系统不允许子进程继续。


操作系统通过系统调用完成进程终止的一般过程如下：
1. 从进程PCB中读取进程的状态。
2. 若进程正在执行，则终止进程的执行。
3. 若进程存在子进程，在大多数情况下需要终止子进程。
4. 释放资源。
5. 将终止进程的PCB移除。

![操作系统-进程控制-终止.png](/assets/img/操作系统-进程控制-终止.png)
