---
layout: post
subtitle: 《操作系统》 17小节： 程序的链接与装入
tags: [操作系统]
comments: false
cover-img: /assets/img/IMG_1753.JPG
thumbnail-img: /assets/img/操作系统概论.jpeg
share-img: /assets/img/IMG_1482.JPG
---

内存管理管理的目标一方面实现内存的分配，内存回收等基本的内存管理功能，另一方面是要提高内存空间的利用率和内存访问速度。

# 操作系统

##  内存管理

1. **计算机硬件为程序的运行提供了什么样子的存储器使用方式？**
2. **操作系统为应用程序提供了什么样的存储服务？**
3. **操作系统怎样将多个不同用户进程放在一个内存中，并使它们不相互干扰的并发执行？**
4. **操作系统如何为进程提供的远比物理内存大的多的虚拟内存空间？**


### 存储器的层次结构


| 层次 | 描述         | 访问周期   |
|:--:|:----------:|:------:|
| L0 | 寄存器        | 0      |
| L1 | 芯片内的L1高速缓存 | 1～10   |
| L2 | 芯片外的L2高速缓存 | 1～10   |
| L3 | 主存         | 50～100 |
| L4 | 本地二级存储     | 2000W  |
| L5 | 远程二级存储     |        |
|    |            |        |

### 程序执行的局部性原理

程序执行的局部性原理指出，程序在执行时呈现出的局部性规律，即在一段较短的时间内，程序的执行仅限于某个部分，相应的，他所访问的存储空间也局限于某个区域。

局部性原理表现为空间和时间的局部性。

1）时间局部性。如果程序中的莫个指令一旦执行，则在不久之后该指令可能再次执行。

2）空间局部性。一旦程序访问了某个单元，不久之后，其附近的存储单元也将被访问。

> 具有良好局部性的程序经常访问相的数据集合或相邻的数据集合。具有良好局部性的程序比局部性差的程序能更好的利用处于高层的存储器，因此运行速度更快。例如：不同的矩阵初始化程序，执行相同数量的赋值，由于程序的不同，具有不同的局部性，其运行速度可能相差很大。

### 程序的链接和装入

#### 程序的链接
> 链接程序不属于操作系统的构成部分，但是它为操作系统提供可装入的程序模块。链接程序要解决的问题是将编译后的目标模块装配成一个可执行的程序。根据链接进行的时间和实现方式的不同，可以把链接分为静态链接和动态链接。

**1.静态链接**

静态链接是在程序运行前，用链接程序将目标模块链接成一个完整的装入模块。静态链接程序的任务一是对逻辑地址进行修改，二是变换外部调用符号。

**2.动态链接**

采用动态链接，可将某些目标模块的链接推迟到这些模块中的函数被调用时才进行。

静态链接相对应动态链接而言，程序运行速度较快。但是无论程序在本次运行中会不会被执行，都将全部被链接到一个可执行文件中，使可执行文件比较大，占用的内，外存空间比较大，使存储开销较大。另外使用静态链接的方式，程序开发不够灵活，方便，修改某一个模块会导致整个程序重新链接。采用动态链接的优点是节省内存和外村空间，方便了开发。

#### 程序的装入
> 将一个用户的源程序变为一个可在内存中执行的程序，通常经过编译，链接，装入 3 个阶段。通常，可执行的程序以二进制可执行文件的形式存储在磁盘上，为执行程序，操作系统需要把程序调入内存。根据形成在内存中的物理地址的时机不同，把程序的装入分为绝对装入方式，可重定向装入方式（静态重定位）和动态运行时装入。

**1.绝对装入**

编译程序事先已知程序在内存中的驻留位置，编译时产生物理地址的目标代码，绝对装入程序按照装入模块的物理地址将程序和数据装入内存。因此装入模块被装入内存后，无需对程序和数据的地址进行修改。


**2.可重定位装入方式（静态重定位）**

在多道程序系统中，众多用户进程共享内存空间，什么时候空闲，内存的那一块区域空闲，可以让操作系统在此装入新的进程是无法预知的。因此，编译器在编译程序时无法形成程序的物理地址。如果编译时不知道目标程序驻留在内存的什么位置，那么编译时就必须生成重定位代码，其中的地址都是逻辑地址，在程序被装入内存时，才把这些逻辑地址映射成物理地址。在程序装入时对目标程序中的指令和数据地址修改的过程称为重定位。

可重定位方式的两个特点如下：

1）编译程序使目标模块的起始地址从0开始。

2）程序装入时，装入程序根据内存的使用情况将装入模块装入到内存的莫个位置，并对模块进行重定位。

物理地址 = 有效逻辑地址 + 程序在内存中的起始地址。


**3.动态运行时装入（动态重定位）**

进程在装入内存后，还可能从内存的一个区域移动到另为一个区域。这种情况可能发生在支持虚拟存储的系统中。一个进程被换出之前所在的内存位置和后来被从外存中重新调用内存所在的内存地址不同，在这种情况下，地址映射必须延迟到进程执行再进行，把这种装入称为动态运行时装入。

在采用动态运行时装入的系统中，系统将进程装入内存后，由于进程在内存中的位置可能发生移动，所以此时并不计算物理地址，而是在进程运行访问的过程中才进行地址转换，这种方式需要重定位寄存器的支持。

每一个CPU都有一个重定位寄存器，当发生进程切换时，要用获取CPU的进程在内存的起始地址更新重定位寄存器。






 